># JPA의 데이터 타입 분류

- ## 엔티티 타임
	
   - @Entity로 정의하는 객체
   - 데이터가 변해도 식별자로 지속해서 추적 가능
   - 예) 회원 엔티티의 키나 나이 값을 변경해도 식별자로 인식 가능
  
- ## 값 타입
	
    - int Integer, String 처럼 단순히 값으로 사용하는 자바 기본 타입이나 객체
    - 식별자가 없고 값만 있으므로 변경시 추적 불가
    - 예) 100을 200으로 변경하면 완전히 다른 값으로 대체
---
> ## 값 타입 분류

- 기본값 타입: int, double, Long, String..
	
    - 생명주기를 엔티티의 의존
    - 값 타입은 공유 X: 회원 이름 변경시 다른 회원 이름이 변경되면 안됨
- 임베디드 타입: 복합 값 타입. 즉, 좌표(x,y)처럼 두 개 이상의 값을 묶어서 사용
	
    - 새로운 값 타입을 직접 정의할 수 있음
    - int, String과 같은 값 타입
    - @Embeddable: 값 타입을 정의하는 곳에 표시
    - @Embedded: 값 타입을 사용하는 곳에 표시
    - 기본 생성자 필수
    
    - ![](https://velog.velcdn.com/images/yseo14/post/24aaefd6-e5f1-4083-b9c5-8702c480d334/image.png)
	 ![](https://velog.velcdn.com/images/yseo14/post/c29d7279-b761-4ea5-a716-ce4cb562f03f/image.png)
	![](https://velog.velcdn.com/images/yseo14/post/1341766f-2fd1-46f5-a683-6cdc17ecb65a/image.png)
    ![](https://velog.velcdn.com/images/yseo14/post/7ee15bf9-5289-4f23-a486-92bf5e7e17be/image.png)



- 컬렉션 값 타입: 자바 컬렉션에 기본값이나 임베디드 타입을 넣을 수 있는 것
- @AttributeOverride: 속성 재정의
- 한 엔티티에서 같은 값 타입을 사용하면 컬럼명이 중복됨
- 예) 주소라는 값 타입이 집주소, 회사주소 등으로 여러개 사용될 경우
- @AttributeOverrides, @AttributeOverride를 사용해서 컬러 명 속성을 재정의
---
> ##  값 타입과 불변 객체

값 타입 공유 참조
- 임베디드 타입 같은 값 타입을 여러 엔티티에서 공유하면 위험함.
- 부작용 발생
![](https://velog.velcdn.com/images/yseo14/post/91219536-8b27-4af5-8c83-23bab163e40d/image.png)

값 타입 복사
- 값 타입의 실제 인스턴스인 값을 공유하는 것은 위험
- 대신 값(인스턴스)를 복사해서 사용
![](https://velog.velcdn.com/images/yseo14/post/67646743-1810-4111-bb69-f3a5b0c2c5ae/image.png)

불변 객체: 생성 시점 이후 절대 값을 변경할 수 없는 객체
- 객체 타입을 수정할 수 없게 만들면 부작용을 원천 차단.
- 값 타입은 불변 객체로 설계해야함.
- 생성자로만 값을 설정하고 수정자(setter)을 만들지 않으면 됨.
---
> ## 값타입의 비교

값 타입: 인스턴스가 달라도 그 안에 값이 같으면 같은 것으로 봐야 함
- 동일성(identity) 비교: 인스턴스의 참조 값 비교, == 사용
- 동등성(equivalence) 비교: 인스턴스의 값을 비교, equals() 사용
- 값 타입은 a.equals(b)를 사용하여 동등성 비교를 해야함.
---
> ## 값 타입 컬렉션

- 값 타입을 하나 이상 저장할 때 사용
- @ElementCollection, @CollectionTable 사용
- 데이터베이스는 컬렉션을 같은 테이블에 저장할 수 없다. 
- 컬렉션을 저장하기 위한 별도의 테이블이 필요

### 제약사항
- 값 타입은 엔티티와 다르게 식별자 개념이 없다. 
- 값은 변경하면 추적이 어려움
- 값 타입 컬렉션에 변경 사항이 발생하면, 주인 엔티티와 연관된 모든 데이터를 삭제하고, 값 타입 컬렉션에 있는 현재 값을 모두 다시 저장함.
- 값 타입 컬렉션을 매칭하는테이블은 모든 컬럼을 묶어서 기본 키를 구성해야함. 
### 대안
- 실무에서는 상황에 따라 값 타입 대신 일대다 관계를 고려.
- 영속성 전이(Cascade)+고아객체 제거를 사용하여 값타입 컬렉션처럼 사용.

---




