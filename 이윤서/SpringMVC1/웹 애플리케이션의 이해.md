# 웹 서버

- HTTP 기반으로 동작
- 정적 리소스 제공, 기타 부가기능

# 웹 애플리케이션 서버(WAS)
- HTTP 기반으로 동작
- 웹 서버 기능 포함 + (정적 리소스 제공 가능)
- 프로그램 코드를 실행해서 애플리케이션 로직 수행


>
## 차이
- 웹 서버는 정적 리소스 파일,  WAS는 애플리케이션 로직
- WAS는 애플리케이션 코드를 실행하는데 특화

> 
## 웹 시스템의 구성
1. WAS, DB
	- 두 개만으로도 시스템 구성이 가능하나 WAS가 정적 리소스, 애플리케이션 코드를 모두 제공하며 과부하 우려
    - 애플리케이션 로직이 정적 리소스 때문에 수행이 어려울 수 있음. 
    - WAS 장애시 오류 화면도 노출 불가능
2. WEB, WAS, DB
	- 정적 리소스는 웹 서버가 처리
    - 웹 서버는 애플리케이션 로직 같은 동적인 처리가 필요하면 WAS에 요청을 위임
    - WAS는 중요한 애플리케이션 로직 처리 전담.
    - 효율적인 리소스 관리 가능
    - 애플리케이션 로직이 동작하는 WAS가 죽었을 때 웹 서버가 오류 화면 제공 가능

---
# 서블릿
![](https://velog.velcdn.com/images/yseo14/post/761a972a-eaa3-47b8-954c-5b9268f3a1c7/image.png)웹 애플리케이션 서버를 직접 구현할 경우 왼쪽의 과정을 직접 전부 구현해야함.

![](https://velog.velcdn.com/images/yseo14/post/c286b1f7-13f0-4492-8e86-5e5e1fdd026e/image.png)
하지만 서블릿을 지원하는 WAS를 사용할 경우 비즈니스 로직을 제외한 과정을 모두 서블릿이 지원해줌.

- HTTP 요청 및 응답 정보를 편리하게 사용하고 제공할 수 있음.

![](https://velog.velcdn.com/images/yseo14/post/9253657f-65bf-4fef-8bdb-d3e10ca957c6/image.png)
- HTTP 요청시
	
    - WAS는 Request, Response 객체를 새로 만들어 서블릿 객체를 호출
    - 개발자는 Request 객체에서 HTTP 요청 정보를 편리하게 꺼내서 사용 
    - 개발자는 Response 객체에 HTTP 응답 정보를 편리하게 입력
    - WAS는 Response 객체에 담겨있는 내용으로 HTTP 응답 정보를 생성
    
  
## 서블릿 컨테이너
  ![](https://velog.velcdn.com/images/yseo14/post/4cecd25d-3463-486b-9dd7-84cd58bf56dc/image.png)

- 톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고함.
- 서블릿 컨테이너는 서블릿 객체를 생성, 초기화, 호출, 종료하는 생명주기를 관리
- 서블릿 객체는 싱글톤으로 관리
- 동시 요청을 위한 멀티 스레드 처리 지원

---
# 동시 요청 - 멀티 쓰레드
## 쓰레드
- 애플리케이션 코드를 하나하나 순차적으로 실행하는 것은 쓰레드
- 쓰레드가 없다면 자바 애플리케이션 실행이 불가능, 쓰레드는 한번에 하나의 코드 라인만 실행.
 - 동시 처리가 필요하다면 쓰레드를 추가로 생성
 
 
![](https://velog.velcdn.com/images/yseo14/post/dacbe7a8-ef83-4e98-9c7e-caa7e6541e8e/image.png)쓰레드를 하나만 사용할 경우 [요청 1]을 처리하는 중 [요청 2]가 들어오면 처리가 지연됨.  

위를 해결하기 위한 방법 중 하나로 요청마다 쓰레드를 생성하는 방법이 있음. 
![](https://velog.velcdn.com/images/yseo14/post/1c5dfb0f-2ec1-48b7-a9cb-9e0ba25f5cf1/image.png)

장점: 
- 동시 요청 처리 가능
- 리소스가 허용할 때까지 처리 가능
- 하나의 쓰레드가 지연되어도 나머지 쓰레드가 동작

단점: 
- 쓰레드 생성 비용은 매우 비쌈. 
- 쓰레드는 컨텍스트 스위칭 비용이 발생함. 
- 쓰레드 생성에 제한이 없음(요청이 너무 많을 경우 CPU, 메모리 임계점을 넘어 서버가 다운될 수 있음.)

## 쓰레드 풀
![](https://velog.velcdn.com/images/yseo14/post/5b94028c-e15d-4710-888a-8cf61f05ba53/image.png)

요청마다 쓰레드를 생성하는 방법의 단점을 보완하는 방법.

>
#### 특징: 
- 필요한 쓰레드를 쓰레드 풀에 보관하고 관리.
- 쓰레드 풀에 생성 가능한 쓰레드의 최대치를 관리함.
#### 사용:
- 쓰레드가 필요하면 이미 생성되어있는 쓰레드를 쓰레드 풀에서 꺼내서 사용
- 사용 종료시 쓰레드 풀에 다시 쓰레드를 반납
- 최대 쓰레드를 모두 사용하고 있을 경우 요청을 거절하거나 일정 숫자만큼 대기하도록 설정 가능
#### 장점: 
- 쓰레드가 미리 생성되어 있으므로, 쓰레드를 생성하고 종료하는 비용이 절약
- 생성 가능한 최대치가 있으므로 너무 많은 요청이 들어와도 기존 요청을 안전하게 처리 가능.

이러한 멀티 쓰레드를 WAS가 지원함. 
- 개발자가 멀티 쓰레드 관련 코드를 신경 쓰지 않아도 됨.
- 멀티 쓰레드 환경이므로 싱글톤 객체를 주의해서 사용해야함