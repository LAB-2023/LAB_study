# ê°’ íƒ€ì…

# ê¸°ë³¸ê°’ íƒ€ì…

## JPAì˜ ë°ì´í„° íƒ€ì… ë¶„ë¥˜

- ì—”í‹°í‹° íƒ€ì…
    - @Entityë¡œ ì •ì˜í•˜ëŠ” ê°ì²´
    - ë°ì´í„°ê°€ ë³€í•´ë„ ì‹ë³„ìë¡œ ì§€ì†í•´ì„œ ì¶”ì  ê°€ëŠ¥
- ê°’ íƒ€ì…
    - int, Integer, Stringì²˜ëŸ¼ ë‹¨ìˆœíˆ ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ìë°” ê¸°ë³¸ íƒ€ì…ì´ë‚˜ ê°ì²´
    - ì‹ë³„ìê°€ ì—†ê³  ê°’ë§Œ ìˆìœ¼ë¯€ë¡œ ë³€ê²½ ì‹œ ì¶”ì  ë¶ˆê°€

## ê°’ íƒ€ì… ë¶„ë¥˜

- ê¸°ë³¸ê°’ íƒ€ì… : ìë°” ê¸°ë³¸ íƒ€ì…(int, double), ë˜í¼ í´ë˜ìŠ¤(Integer, Long), String
- ì„ë² ë””ë“œ íƒ€ì…(embedded type, ë³µí•© ê°’ íƒ€ì…)
    - JPAì—ì„œ ì •ì˜í•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- ì»¬ë ‰ì…˜ ê°’ íƒ€ì…(collection value type)
    - JPAì—ì„œ ì •ì˜í•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
    - ì»¬ë ‰ì…˜ì— ê¸°ë³¸ê°’ ë˜ëŠ” ì„ë² ë””ë“œ íƒ€ì…ì„ ë„£ì€ í˜•íƒœì´ë‹¤.

<aside>
ğŸ’¡ **ë˜í¼ í´ë˜ìŠ¤(Wrapper Class)ë€?**

**ê¸°ë³¸ ìë£Œíƒ€ì…(primitive type)ì„ ê°ì²´ë¡œ ë‹¤ë£¨ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ë“¤ì„ ë˜í¼ í´ë˜ìŠ¤(wrapper class)ë¼ê³  í•©ë‹ˆë‹¤.**

<img width="630" alt="1" src="https://github.com/LAB-2023/LAB_study/assets/125250173/9ec38f54-f12b-4f7d-bd36-a7823b4afdb9">

**[ë°•ì‹±, ì–¸ë°•ì‹±]**

<img width="500" alt="2" src="https://github.com/LAB-2023/LAB_study/assets/125250173/a50a2680-efb9-4b12-bf89-8708e3abc1a9">

ê¸°ë³¸ íƒ€ì…ì˜ ê°’ì„ í¬ì¥ ê°ì²´ë¡œ ë§Œë“œëŠ” ê³¼ì •ì„ ë°•ì‹±ì´ë¼ê³  í•˜ê³  ë°˜ëŒ€ë¡œ í¬ì¥ê°ì²´ì—ì„œ ê¸°ë³¸íƒ€ì…ì˜ ê°’ì„ ì–»ì–´ë‚´ëŠ” ê³¼ì •ì„ ì–¸ë°•ì‹±ì´ë¼ê³  í•©ë‹ˆë‹¤.

</aside>

### ê¸°ë³¸ê°’ íƒ€ì…

**ìƒëª…ì£¼ê¸°ë¥¼ ì—”í‹°í‹°ì˜ ì˜ì¡´**

ex) íšŒì›ì„ ì‚­ì œí•˜ë©´ ì´ë¦„, ë‚˜ì´ í•„ë“œë„ í•¨ê»˜ ì‚­ì œ

**ê°’ íƒ€ì…ì€ ê³µìœ í•˜ë©´ ì•ˆëœë‹¤.**

ex) íšŒì› ì´ë¦„ ë³€ê²½ ì‹œ ë‹¤ë¥¸ íšŒì›ì˜ ì´ë¦„ë„ í•¨ê»˜ ë³€ê²½ë˜ë©´ ì•ˆëœë‹¤.

<aside>
ğŸ“Œ **[ì°¸ê³ ] ìë°”ì˜ ê¸°ë³¸ íƒ€ì…ì€ ì ˆëŒ€ ê³µìœ  ì•ˆëœë‹¤.**

- int, double ê°™ì€ ê¸°ë³¸ íƒ€ì…ì€ ì ˆëŒ€ ê³µìœ  ì•ˆëœë‹¤.
    - ì¦‰, ***side effect***ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
- ê¸°ë³¸ íƒ€ì…ì€ í•­ìƒ ê°’ì„ ë³µì‚¬í•œë‹¤.
- Integerê°™ì€ ë˜í¼ í´ë˜ìŠ¤ë‚˜ String ê°™ì€ íŠ¹ìˆ˜í•œ í´ë˜ìŠ¤ëŠ” ê³µìœ  ê°€ëŠ¥í•œ ê°ì²´ì´ì§€ë§Œ ë³€ê²½ ì•ˆëœë‹¤.
    
    ```java
    Integer a = new Integer(10);
    Integer b = a; // aì˜ ì°¸ì¡°ë¥¼ ë³µì‚¬ 
    a.setValue(20); // Side Effect!! 
    ```
    
</aside>

# ì„ë² ë””ë“œ íƒ€ì…

- ìƒˆë¡œìš´ ê°’ íƒ€ì…ì„ ì§ì ‘ ì •ì˜í•  ìˆ˜ ìˆë‹¤.
- ì£¼ë¡œ ê¸°ë³¸ ê°’ íƒ€ì…ì„ ëª¨ì•„ì„œ ë§Œë“¤ì–´ì„œ ë³µí•© ê°’ íƒ€ì…ì´ë¼ê³ ë„ í•œë‹¤.

## ì„ë² ë””ë“œ íƒ€ì… ì‚¬ìš©ë²•

- `@Emveddable`
    - ê°’ íƒ€ì…ì„ ì •ì˜í•˜ëŠ” ê³³ì— í‘œì‹œ
- `@Embedded`
    - ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ëŠ” ê³³ì— í‘œì‹œ

*c.f. ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ëª…ì‹œí•´ë„ ë˜ì§€ë§Œ, ë‘˜ ë‹¤ ë„£ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.*

- ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜

## ì„ë² ë””ë“œ íƒ€ì… íŠ¹ì§•ê³¼ ì¥ì 

- ì¬ì‚¬ìš©
- ë†’ì€ ì‘ì§‘ë„
- `Period.isWork()`ì²˜ëŸ¼ í•´ë‹¹ ê°’ íƒ€ì…ë§Œ ì‚¬ìš©í•˜ëŠ” ì˜ë¯¸ ìˆëŠ” ë©”ì†Œë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
    - ê°ì²´ì§€í–¥ì ì¸ ì„¤ê³„ê°€ ê°€ëŠ¥í•˜ë‹¤.
- ì„ë² ë””ë“œ íƒ€ì…ì„ í¬í•¨í•œ ëª¨ë“  ê°’ íƒ€ì…ì€, ê°’ íƒ€ì…ì„ ì†Œìœ í•œ ì—”í‹°í‹°ì— ìƒëª…ì£¼ê¸°ë¥¼ ì˜ì¡´í•œë‹¤.
    - ì¶”ì ì´ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë³€ê²½í•˜ë©´ ëë‚œë‹¤.
    - ì—”í‹°í‹°ê°€ ì•„ë‹ˆê³  ***ì—”í‹°í‹°ì˜ ê°’***ì´ë‹¤.
- ì„ë² ë””ë“œ íƒ€ì…ì„ ì‚¬ìš©í•˜ê¸° ì „ê³¼ í›„ì— ë§¤í•‘í•˜ëŠ” í…Œì´ë¸”ì€ ê°™ë‹¤.
- ì„ë² ë””ë“œ íƒ€ì…ì˜ ê°’ì´ **null**ì´ë©´ ë§¤í•‘í•œ ì»¬ëŸ¼ ê°’ ëª¨ë‘ **null**ì´ë‹¤.
- ê°ì²´ì™€ í…Œì´ë¸”ì„ ì•„ì£¼ ì„¸ë°€í•˜ê²Œ ë§¤í•‘í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.
- ì˜ ì„¤ê³„í•œ ORM ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë§¤í•‘í•œ í…Œì´ë¸”ì˜ ìˆ˜ë³´ë‹¤ í´ë˜ìŠ¤ì˜ ìˆ˜ê°€ ë” ë§ë‹¤.

## ì„ë² ë””ë“œ íƒ€ì…ê³¼ ì—°ê´€ê´€ê³„

<img width="1009" alt="3" src="https://github.com/LAB-2023/LAB_study/assets/125250173/498f5d34-b192-43c7-9c44-a8220ec92166">

- ì„ë² ë””ë“œ íƒ€ì…ì€ ì„ë² ë””ë“œ íƒ€ì…ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
- ì„ë² ë””ë“œ íƒ€ì…ì€ ì—”í‹°í‹° íƒ€ì…ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
    - FKë§Œ ê°€ì§€ë©´ ë˜ê¸° ë•Œë¬¸ì´ë‹¤.

<aside>
â“ **í•œ ì—”í‹°í‹°ì—ì„œ ê°™ì€ ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´?**

- ì»¬ëŸ¼ ëª…ì´ ì¤‘ë³µëœë‹¤.

**[ë¬¸ì œ ìƒí™©]**

```java
@Entity
  public class Member {
  ...
  @Embedded
  private Address homeAddress; // ì£¼ì†Œ 
  @Embedded
  private Address workAddress; // ì£¼ì†Œ 
  ...
  }
```

**[Soultion]**

**`@AttributeOverrides`, `@AttributeOverride`ë¥¼ ì‚¬ìš©í•´ì„œ ì»¬ëŸ¼ ëª… ì†ì„±ì„ ì¬ì •ì˜í•œë‹¤.**

```java
@Entity
public class Member {
  ...
  @Embedded
  private Address homeAddress;
  @Embedded
  @AttributeOverrides({ // ìƒˆë¡œìš´ ì»¬ëŸ¼ì— ì €ì¥ (ì»¬ëŸ¼ëª… ì†ì„± ì¬ì •ì˜)
    @AttributeOverride(name="city", column=@Column(name = "WORK_CITY"),
    @AttributeOverride(name="street", column=@Column(name = "WORK_STREET"),
    @AttributeOverride(name="zipcode", column=@Column(name = "WORK_ZIPCODE")})
  private Address workAddress;
  ...
}
```

</aside>

# ê°’ íƒ€ì…ê³¼ ë¶ˆë³€ ê°ì²´

ê°’ íƒ€ì…ì€ ë³µì¡í•œ ê°ì²´ë¥¼ ë‹¨ìˆœí™”í•˜ê¸° ìœ„í•´ ë§Œë“  ê°œë…ì´ë‹¤.

## ê°’ íƒ€ì… ê³µìœ  ì°¸ì¡°

ì„ë² ë””íŠ¸ íƒ€ì… ê°™ì€ ê°’ íƒ€ì…ì„ ì—¬ëŸ¬ ì—”í‹°í‹°ì—ì„œ ê³µìœ í•˜ë©´ ìœ„í—˜í•¨

## ê°’ íƒ€ì… ë³µì‚¬

- ê°’ íƒ€ì…ì˜ ì‹¤ì œ ì¸ìŠ¤í„´ìŠ¤ì¸ ê°’ì„ ê³µìœ í•˜ëŠ” ê²ƒì€ ìœ„í—˜
- ëŒ€ì‹  ê°’(ì¸ìŠ¤í„´ìŠ¤)ë¥¼ ë³µì‚¬í•´ì„œ ì‚¬ìš©

<img width="843" alt="4" src="https://github.com/LAB-2023/LAB_study/assets/125250173/9fb4df73-3f69-4c14-9da5-9042f589d56a">

```java
public class JpaMain {

    public static void main(String[] args) {
        Address address = new Address("city", "street", "10012");

        Member member = new Member();
        member.setUsername("member1");
        member.setAddress(address);
        em.persist(member);

        // ê°’ì„ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•œë‹¤.
        Address address2 = new Address(address.getCity(), address.getStreet(), address.getZipcode());

        Member member2 = new Member();
        member2.setUsername("member2");
        member2.setAddress(address2);
        em.persist(member2);

        // ì´ì œ íšŒì› 1ë§Œ update ì¿¼ë¦¬ê°€ ë‚˜ê°„ë‹¤.
        member.getAddress().setCity("new City");

        tx.commit();
    }
}
```

## ê°ì²´ íƒ€ì…ì˜ í•œê³„

í•­ìƒ ê°’ì„ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ë©´ ê³µìœ  ì°¸ì¡°ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ë¶€ì‘ìš©ì„ í”¼í•  ìˆ˜ ìˆë‹¤.

- âš ï¸Â ì„ë² ë””ë“œ íƒ€ì…ì²˜ëŸ¼ ì§ì ‘ ì •ì˜í•œ ê°’ íƒ€ì…ì€ ìë°”ì˜ ê¸°ë³¸ íƒ€ì…ì´ ì•„ë‹ˆë¼ ê°ì²´ íƒ€ì…ì´ë‹¤.
- ìë°” ê¸°ë³¸ íƒ€ì…ì— ê°’ì„ ëŒ€ì…í•˜ë©´ ê°’ì„ ë³µì‚¬í•œë‹¤.
    - ê°ì²´ íƒ€ì…ì€ ì°¸ì¡° ê°’ì„ ì§ì ‘ ëŒ€ì…í•˜ëŠ” ê²ƒì„ ë§‰ì„ ë°©ë²•ì´ ì—†ë‹¤. â†’ ê°ì²´ì˜ ê³µìœ  ì°¸ì¡°ëŠ” í”¼í•  ìˆ˜ ì—†ë‹¤.
        
        <img width="936" alt="5" src="https://github.com/LAB-2023/LAB_study/assets/125250173/1a1c1fcf-be77-4bc0-aab1-9a617c6c4973">
        

## ë¶ˆë³€ ê°ì²´(immutable object)

: ìƒì„± ì‹œì  ì´í›„ ì ˆëŒ€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ê°ì²´

- ê°ì²´ íƒ€ì…ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ê²Œ ë¶ˆë³€ ê°ì²´ë¡œ ì„¤ê³„í•˜ì—¬ ë¶€ì‘ìš©ì„ ì›ì²œ ì°¨ë‹¨ì‹œí‚´.
- **ìƒì„±ìë¡œë§Œ ê°’ì„ ì„¤ì •í•˜ê³  ìˆ˜ì •ì(Setter)ë¥¼ ë§Œë“¤ì§€ ì•Šìœ¼ë©´ ëœë‹¤.**
- ğŸ“Œì°¸ê³ 
    - Integer, Stringì€ ìë°”ê°€ ì œê³µí•˜ëŠ” ëŒ€í‘œì ì¸ ë¶ˆë³€ ê°ì²´

```java
public class JpaMain {

    public static void main(String[] args) {
        Address address = new Address("city", "street", "10012");

        Member member = new Member();
        member.setUsername("member1");
        member.setAddress(address);
        em.persist(member);

        // cityë¥¼ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´ setCity() ëŒ€ì‹  
        // Address ê°ì²´ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ í†µìœ¼ë¡œ ê°ˆì•„ ë¼ìš´ë‹¤.
        Address newAddress = new Address("new city", address.getStreet(), address.getZipcode());
        member.setAddress(newAddress);

        tx.commit();
    }
}
```

# ê°’ íƒ€ì…ì˜ ë¹„êµ

ê°’ íƒ€ì… : ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¬ë¼ë„ ê·¸ ì•ˆì— ê°’ì´ ê°™ìœ¼ë©´ ê°™ì€ ê²ƒìœ¼ë¡œ ë´ì•¼í•¨.

 

## ë™ì¼ì„±(identity) ë¹„êµ

ì¸ìŠ¤í„´ìŠ¤ì˜ ì°¸ì¡° ê°’ì„ ë¹„êµ, == ì‚¬ìš©

## ë™ë“±ì„±(equivalence) ë¹„êµ

ì¸ìŠ¤í„´ìŠ¤ì˜ ê°’ì„ ë¹„êµ, equals() ì‚¬ìš©

- ê°’ íƒ€ì…ì€ a.equals(b)ë¥¼ ì‚¬ìš©í•´ì„œ ë™ë“±ì„± ë¹„êµë¥¼ í•´ì•¼í•¨.
- ê°’ íƒ€ì…ì˜ equals() ë©”ì†Œë“œë¥¼ ì ì ˆí•˜ê²Œ ì¬ì •ì˜(ì£¼ë¡œ ëª¨ë“  í•„ë“œ ì‚¬ìš©)

```java
class Address {
    @Override
    public boolean equals(Object o) {
        if (this == o) {
            return true;
        }
        if (o == null || getClass() != o.getClass()) {
            return false;
        }
        Address address = (Address) o;
        return Objects.equals(city, address.city) && Objects
                .equals(street, address.street) && Objects.equals(zipcode, address.zipcode);
    }

    // equals()ë¥¼ êµ¬í˜„í•˜ë©´ hashCode()ë„ ë§Œë“¤ì–´ì¤˜ì•¼
    // í•´ì‹œ ë§µ ë“± ìë°” ì»¬ë ‰ì…˜ì—ì„œ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    @Override
    public int hashCode() {
        return Objects.hash(city, street, zipcode);
    }
}
```

# ê°’ íƒ€ì… ì»¬ë ‰ì…˜

ê°’ íƒ€ì…ì„ ì»¬ë ‰ì…˜ì— ë‹´ì•„ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹

- DBëŠ” ì»¬ë ‰ì…˜ì„ ë‹´ì„ ìˆ˜ ìˆëŠ” íƒ€ì…ì´ ì—†ë‹¤.
- ì¼ëŒ€ë‹¤ ê°œë…ì²˜ëŸ¼ ë³„ë„ì˜ í…Œì´ë¸”ì„ ë§Œë“ ë‹¤.
- ë³„ë„ì˜ ì‹ë³„ì ì—†ì´ ì†Œì†ëœ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ì™€ ê°’ íƒ€ì…ì„ ì¡°í•©í•´ PKë¡œ ì“´ë‹¤.
    - IDë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ PKë¥¼ ì“°ê²Œ ë˜ë©´ ê°’ íƒ€ì…ì´ ì•„ë‹ˆë¼ Entityê°€ ë˜ê¸° ë•Œë¬¸ì´ë‹¤.
- **@ElementCollection, @CollectionTable**

<img width="804" alt="6" src="https://github.com/LAB-2023/LAB_study/assets/125250173/195782a6-50b9-40a7-843d-f9bf2e9ff172">

```java
@Entity
public class Member {

    @Id
    @GeneratedValue
    private Long id;

    @Column(name = "name")
    private String username;

    @Embedded
    private Address homeAddress;

    // ì»¬ë ‰ì…˜ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ê°’ íƒ€ì…ì— ë‹¬ì•„ì¤€ë‹¤.
    @ElementCollection
    @CollectionTable(
            // ê°’ì„ ë„£ì„ í…Œì´ë¸” ì´ë¦„ì„ ì •ì˜í•œë‹¤. 
            name = "FAVORITE_FOOD",
            // ì™¸ë˜í‚¤ë¥¼ ëª…ì‹œí•œë‹¤.
            joinColumns = @JoinColumn(name = "MEMBER_ID"))
    // addressHistoryëŠ” Address íƒ€ì… ë‚´ë¶€ì— city, address ë“± ë‹¤ì–‘í•œ í•„ë“œê°€ ìˆì§€ë§Œ
    // favoriteFoodsëŠ” String í•˜ë‚˜ì´ê³  ë‚´ê°€ ì •ì˜í•œ íƒ€ì…ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì¹¼ëŸ¼ ì´ë¦„ì„ ì§€ì •í•´ì¤„ ìˆ˜ ìˆë‹¤.
    @Column(name = "FOOD_NAME")
    private Set<String> favoriteFoods = new HashSet<>();

    @ElementCollection
    @CollectionTable(name = "ADDRESS", joinColumns = @JoinColumn(name = "MEMBER_ID"))
    private List<Address> addressHistory = new ArrayList<>();
}
```

## ê°’ íƒ€ì… ì €ì¥

```java
public class JpaMain {

    public static void main(String[] args) {
        Member member = new Member();
        member.setUsername("member1");
        member.setHomeAddress(new Address("home city", "street", "12345"));

        // ê°’ íƒ€ì… ì»¬ë ‰ì…˜
        member.getFavoriteFoods().add("ì¹˜í‚¨");
        member.getFavoriteFoods().add("ì¡±ë°œ");
        member.getFavoriteFoods().add("í”¼ì");

        member.getAddressHistory().add(new Address("old1", "street", "12345"));
        member.getAddressHistory().add(new Address("old2", "street", "12345"));

        // memberë§Œ ì˜ì†í™” í•œë‹¤.
        em.persist(member);

        tx.commit();
    }
}
```

- ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì„ ë”°ë¡œ persist í•˜ì§€ ì•Šê³  `member`ë§Œ persistí–ˆëŠ”ë°ë„ ê°™ì´ ì €ì¥ëë‹¤.
- ê°’ íƒ€ì…ì€ `member`ì— ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì— `member`ê°€ ë³€ê²½ë˜ë©´ ê°™ì´ ë³€ê²½ëœë‹¤.`member`ì™€ ë¼ì´í”„ì‚¬ì´í´ì„ ê°™ì´ í•œë‹¤.

â‡’ ì¦‰, `cascade`ì™€ `orphanRemoval`ì„ ëª¨ë‘ ì¼  ìƒíƒœë¥¼ í•„ìˆ˜ë¡œ ê°€ì§€ê³  ìˆë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.

## ê°’ íƒ€ì… ì¡°íšŒ

```java
public class JpaMain {

    public static void main(String[] args) {
        Member member = new Member();
        member.setUsername("member1");
        member.setHomeAddress(new Address("home city", "street", "12345"));

        member.getFavoriteFoods().add("ì¹˜í‚¨");
        member.getFavoriteFoods().add("ì¡±ë°œ");
        member.getFavoriteFoods().add("í”¼ì");

        member.getAddressHistory().add(new Address("old1", "street", "12345"));
        member.getAddressHistory().add(new Address("old2", "street", "12345"));

        em.persist(member);

        // DBì—ëŠ” ë°ì´í„°ê°€ insertë˜ê³  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•œ ìƒíƒœì—ì„œ
        em.flush();
        em.clear();

        // memberë¥¼ ë‹¤ì‹œ ì¡°íšŒí•œë‹¤.
        Member findMember = em.find(Member.class, member.getId());

        tx.commit();
    }
}
```

- `member`ë¥¼ ì¡°íšŒí•˜ë©´ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì¸ favoriteFoodsì™€ addressHistoryëŠ” ì¡°íšŒë˜ì§€ ì•ŠëŠ”ë‹¤.
- ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì— ìë™ìœ¼ë¡œ **ì§€ì—° ë¡œë”©**ì´ ì ìš©ëê¸° ë•Œë¬¸ì´ë‹¤.
    
    ì„ë² ë””ë“œ íƒ€ì…ì€ ì†Œì†ëœ ê°’ì´ê¸° ë•Œë¬¸ì— `homeAddress`ëŠ” ë‹¹ì—°íˆ ì¡°íšŒë˜ì—ˆë‹¤.
    

## ê°’ íƒ€ì… ìˆ˜ì •

```java
public class JpaMain {

    public static void main(String[] args) {
        Member member = new Member();
        member.setUsername("member1");
        member.setHomeAddress(new Address("home city", "street", "12345"));

        member.getFavoriteFoods().add("ì¹˜í‚¨");
        member.getFavoriteFoods().add("ì¡±ë°œ");
        member.getFavoriteFoods().add("í”¼ì");

        member.getAddressHistory().add(new Address("old1", "street", "12345"));
        member.getAddressHistory().add(new Address("old2", "street", "12345"));

        em.persist(member);

        em.flush();
        em.clear();

        Member findMember = em.find(Member.class, member.getId());

        // ê°’ íƒ€ì…ì¸ ì„ë² ë””ë“œ íƒ€ì…ì€ immutable í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì´ë ‡ê²Œ ë³€ê²½í•˜ë©´ ì ˆëŒ€ ì•ˆëœë‹¤.
        // findMember.getHomeAddress().setCity("new city");

        // address ì¸ìŠ¤í„´ìŠ¤ ìì²´ë¥¼ ê°ˆì•„ë¼ì›Œì•¼ í•œë‹¤.
        Address a = findMember.getHomeAddress();
        findMember.setHomeAddress(new Address("new city", a.getStreet(), a.getZipcode()));

        // ì»¬ë ‰ì…˜ ê°’ íƒ€ì…ë„ ë§ˆì°¬ê°€ì§€ë¡œ ë¶ˆë³€ì„±ì„ ìœ ì§€í•´ì•¼ í•˜ë¯€ë¡œ ì—…ë°ì´íŠ¸ê°€ ì•„ë‹ˆë¼ í†µì§¸ë¡œ ê°ˆì•„ë¼ìš´ë‹¤.
        // ê¸°ì¡´ ê°’ì„ ì§€ìš°ê³  ë‹¤ì‹œ ë„£ëŠ”ë‹¤.
        findMember.getFavoriteFoods().remove("ì¹˜í‚¨");
        findMember.getFavoriteFoods().add("í•œì‹");

        // ì„ë² ë””ë“œ íƒ€ì…ê³¼ ì»¬ë ‰ì…˜ ê°’ íƒ€ì…ì„ ì˜ì†í™” í•˜ëŠ” ì½”ë“œê°€ ì—†ì§€ë§Œ ì¿¼ë¦¬ê°€ ë‚˜ê°„ë‹¤.
        // ì˜ì†ì„± ì „ì´ì™€ ê³ ì•„ ê°ì²´ ì œê±° ê¸°ëŠ¥ì„ í•„ìˆ˜ë¡œ ê°€ì§€ê¸° ë•Œë¬¸ì´ë‹¤.

        tx.commit();
    }
}
```

- ì»¬ë ‰ì…˜ì˜ ê°’ë§Œ ë³€ê²½í•´ë„ ì–´ë–¤ ê°’ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì•Œê³  JPAê°€ ì•Œì•„ì„œ DBì— ì¿¼ë¦¬ë¥¼ ë‚ ë ¤ì¤€ë‹¤.
    
    â†’ ë§ˆì¹˜ ì˜ì†ì„± ì „ì´ê°€ ëœ ê²ƒì²˜ëŸ¼ ë™ì‘í•œë‹¤.
    

ğŸ“ŒÂ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì€ `member`ë¡œ ë¼ì´í”„ ì‚¬ì´í´ì´ ê´€ë¦¬ë˜ëŠ” ë‹¨ìˆœí•œ ì†ì„±ì´ê¸° ë•Œë¬¸ì´ë‹¤.

```java
public class JpaMain {

    public static void main(String[] args) {
        Member member = new Member();
        member.setUsername("member1");
        member.setHomeAddress(new Address("home city", "street", "12345"));

        member.getFavoriteFoods().add("ì¹˜í‚¨");
        member.getFavoriteFoods().add("ì¡±ë°œ");
        member.getFavoriteFoods().add("í”¼ì");

        member.getAddressHistory().add(new Address("old1", "street", "12345"));
        member.getAddressHistory().add(new Address("old2", "street", "12345"));

        em.persist(member);

        em.flush();
        em.clear();

        Member findMember = em.find(Member.class, member.getId());

        // addressë¥¼ í•˜ë‚˜ë§Œ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´ ì§€ìš°ê³  ì‹¶ì€ ê°’ì„ ë„£ê³  remove í•œë‹¤.
        // ì»¬ë ‰ì…˜ì€ ëŒ€ë¶€ë¶„ equals()ë¥¼ ì‚¬ìš©í•´ ì°¾ê³  ì‹¶ì€ ê°’ì„ ê·¸ëŒ€ë¡œ ì°¾ì•„ì¤€ë‹¤.
        // ë”°ë¼ì„œ equals()ë¥¼ ì¬ì •ì˜ í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ê·¸ëƒ¥ ë§í•˜ëŠ” ê²ƒì´ë‹¤. equals()ë¥¼ ê¼­ ì¬ì •ì˜ í•´ì£¼ì.
        findMember.getAddressHistory().remove(new Address("old1", "street", "12345"));
        // ì§€ìš´ ê°’ ëŒ€ì‹  ìƒˆë¡œìš´ ê°’ì„ ë„£ì–´ì¤€ë‹¤.
        findMember.getAddressHistory().add(new Address("new city", "street", "12345"));

        tx.commit();
    }
}
```

- `addressHistory`ì—ì„œ `old1`ë§Œ ìˆ˜ì •í•˜ê³  ì‹¶ë‹¤ë©´ í•´ë‹¹ ê°’ì„ ì°¾ì•„ì„œ ì§€ìš°ê³  ë‹¤ì‹œ ë„£ëŠ”ë‹¤.

ğŸ“ŒÂ ì»¬ë ‰ì…˜ì€ ê°’ì„ ì°¾ì„ ë•Œ ê¸°ë³¸ì ìœ¼ë¡œ `equals()`ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ë°˜ë“œì‹œ ì˜¤ë²„ë¼ì´ë”©ì´ í•„ìš”í•˜ë‹¤.

<aside>
âš ï¸ **ì¿¼ë¦¬ë¥¼ í™•ì¸í•´ë³´ë‹ˆ insertë¬¸ì´ 2ê°œê°€ ë‚˜ê°”ë‹¤.**

í…Œì´ë¸”ì— ìˆëŠ” ë°ì´í„°ë¥¼ ì™„ì „íˆ ê°ˆì•„ë¼ìš°ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤.
1. deleteë¡œ `member_id`ì— í•´ë‹¹í•˜ëŠ” `address` í…Œì´ë¸” ê°’ì„ í†µì§¸ë¡œ ì‚­ì œí•œë‹¤.
2. ê¸°ì¡´ ê°’ì´ì—ˆë˜ `old2`ë¥¼ insert í•œë‹¤.
3. ìƒˆë¡œ ì¶”ê°€í•œ `new city`ë¥¼ insert í•œë‹¤.

</aside>

## ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì˜ ì œì•½ì‚¬í•­

- ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì„ ë§¤í•‘í•˜ëŠ” í…Œì´ë¸”ì€ ëª¨ë“  ì¹¼ëŸ¼ì„ ë¬¶ì–´ì„œ ê¸°ë³¸í‚¤ë¥¼ êµ¬ì„±í•´ì•¼ í•œë‹¤. nullì´ë‚˜ ì¤‘ë³µ ì €ì¥ì€ ë˜ì§€ ì•ŠëŠ”ë‹¤.
- ê°’ íƒ€ì…ì€ Entityì™€ ë‹¤ë¥´ê²Œ ì‹ë³„ì ê°œë…ì´ ì—†ë‹¤. â†’ ê°’ì„ ë³€ê²½í•˜ë©´ ì¶”ì ì´ ì–´ë µë‹¤.
- ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì— ë³€ê²½ ì‚¬í•­ì´ ë°œìƒí•˜ë©´ ì£¼ì¸ Entityì™€ ì—°ê´€ëœ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì— ìˆëŠ” í˜„ì¬ ê°’ì„ ëª¨ë‘ ë‹¤ì‹œ ì €ì¥í•œë‹¤.

â‡’ **ë”°ë¼ì„œ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì€ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²Œ ì¢‹ë‹¤.**

### ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ëŒ€ì•ˆ

- ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ëŒ€ì‹ ì— ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ê³ ë ¤
    - ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ìœ„í•œ Entityë¥¼ ë§Œë“¤ì–´ ê°’ íƒ€ì…ì„ wrapping í•œë‹¤.
    
    **ex.** Addressë¼ëŠ” Entityë¥¼ ë§Œë“¤ ê·¸ ì•ˆì— Addressë¼ëŠ” ê°’ íƒ€ì…ì„ ë„£ëŠ”ë‹¤.Memberì—ëŠ” Addresss ì—”í‹°í‹°ë¥¼ ë„£ê³  ì¼ëŒ€ë‹¤ ì—°ê´€ ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤. ì˜ì†ì„± ì „ì´ì™€ ê³ ì•„ ê°ì²´ ì œê±°ë¥¼ ì ìš©í•œë‹¤.
    â†’ ì´ë ‡ê²Œ í•˜ë©´ ì‹¤ë¬´ì—ì„œ í›¨ì”¬ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    
    ```java
    @Entity
    @Table(name = "ADDRESS")
    public class AddressEntity {
        @Id
        @GeneratedValue
        private Long id;
    
        private Address address;
    
    		public AddressEntity(String city, String street, String zipcode)
    			this.address = new Address(city, street, zipcode);
    }
    ```
    
    ```java
    @Entity
    public class Member {
        ...
    
        @OneToMany(cascade = ALL, orphanRemoval = true)
        @JoinColumn(name = "MEMBER_ID")
        private List<AddressEntity> addressHistory = new ArrayList<>();
    
    }
    ```
    
    ![7](https://github.com/LAB-2023/LAB_study/assets/125250173/09fcbd02-a7cc-4b76-a59e-a305edf74bcf)
    
    - AddressEntityì— ê°’ 2ê°œë¥¼ ì €ì¥í•œë‹¤.
        
        update ì¿¼ë¦¬ê°€ ë‘ ë²ˆ ë‚˜ê°€ëŠ” ê±´ ì–´ì©” ìˆ˜ ì—†ë‹¤.
        
        1:N ë‹¨ë°©í–¥ì€ ë‹¤ë¥¸ í…Œì´ë¸”ì— ì™¸ë˜í‚¤ê°€ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
        
    
    ### í™œìš©
    
    - ì—…ë°ì´íŠ¸ë‚˜ ì¶”ì í•  í•„ìš” ì—†ëŠ” ë‹¨ìˆœí•œ ìƒí™©ì¼ ë•Œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
    **ex.** ì…€ë ‰íŠ¸ ë°•ìŠ¤ì—ì„œ ì¹˜í‚¨, í”¼ì, ì¡±ë°œ ì¤‘ ì„ íƒ, ê·¸ê²Œ ì•„ë‹Œ ì´ìƒ ì›¬ë§Œí•˜ë©´ Entityë¡œ ì‚¬ìš©í•œë‹¤.
    - ê¼­ ê°’ì„ ë³€ê²½í•  ì¼ì´ ì—†ë”ë¼ë„ ì¿¼ë¦¬ ìì²´ë¥¼ ê·¸ í…Œì´ë¸”ì—ì„œ í•  ë•Œê°€ ë§ë‹¤ë©´ Entityë¡œ í•˜ëŠ” ê²Œ ì¢‹ë‹¤.
    **ex.** ì£¼ì†Œ ì´ë ¥ì€ ì…ë ¥ë§Œ í•˜ì§€ë§Œ ì¡°íšŒí•  ì¼ì´ ë§ìœ¼ë¯€ë¡œ Entityë¡œ ë§Œë“ ë‹¤.

# ì •ë¦¬

- Entity íƒ€ì…
    - ì‹ë³„ìê°€ ìˆë‹¤.
    - ìƒëª… ì£¼ê¸°ë¥¼ ë”°ë¡œ ê´€ë¦¬í•œë‹¤.
    - ê³µìœ í•  ìˆ˜ ìˆë‹¤.
- ê°’ íƒ€ì…
    - ì‹ë³„ìê°€ ì—†ë‹¤.
    - ìƒëª… ì£¼ê¸°ë¥¼ Entityì— ì˜ì¡´í•œë‹¤.
    - ê³µìœ í•˜ì§€ ì•Šê³  ë³µì‚¬í•´ì„œ ì‚¬ìš©í•œë‹¤.
    - ë¶ˆë³€ ê°ì²´ë¡œ ë§Œë“¤ì–´ì•¼ ì•ˆì „í•˜ë‹¤.

<aside>
âš ï¸ **ì£¼ì˜**

ê°’ íƒ€ì…ì€ ì •ë§ ê°’ íƒ€ì…ì´ë¼ê³  íŒë‹¨ë  ë•Œë§Œ ì‚¬ìš©í•œë‹¤. Entityì™€ ê°’ íƒ€ì…ì„ í˜¼ë™í•´ì„œ, Entityë¥¼ ê°’ íƒ€ì…ìœ¼ë¡œ ë§Œë“¤ë©´ ì•ˆëœë‹¤.

**ì‹ë³„ìê°€ í•„ìš”**í•˜ê³  ì§€ì†í•´ì„œ **ê°’ì„ ì¶”ì **í•´ì•¼ í•˜ë©° **ë³€ê²½ì´ í•„ìš”**í•˜ë‹¤ë©´ ê°’ íƒ€ì…ì´ ì•„ë‹ˆë¼ Entityê°€ ë˜ì–´ì•¼ í•œë‹¤.

</aside>
