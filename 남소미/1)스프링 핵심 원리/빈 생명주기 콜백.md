# ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°±

### ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°± ì‹œì‘

- ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— í•„ìš”í•œ ì—°ê²°ì„ ë¯¸ë¦¬ í•´ë‘ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œì ì— ì—°ê²°ì„ ëª¨ë‘ ì¢…ë£Œí•˜ëŠ” ì‘ì—…ì„ ì§„í–‰
    
    â†’ **ê°ì²´ì˜ ì´ˆê¸°í™”ì™€ ì¢…ë£Œ ì‘ì—…ì´ í•„ìš”**í•˜ë‹¤.
    

- ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì  â†’ connect() ë¥¼ í˜¸ì¶œí•´ì„œ ì—°ê²°
- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¢…ë£Œ â†’ disConnect() ë¥¼ í˜¸ì¶œí•´ì„œ ì—°ê²°ì„ ëŠìŒ

```java
public class NetworkClient {
 private String url;

 public NetworkClient() {
 System.out.println("ìƒì„±ì í˜¸ì¶œ, url = " + url);
 connect();
 call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
 }

 public void setUrl(String url) {
 this.url = url;
 }

 //ì„œë¹„ìŠ¤ ì‹œì‘ì‹œ í˜¸ì¶œ
 public void connect() {
 System.out.println("connect: " + url);
 }

 public void call(String message) {
 System.out.println("call: " + url + " message = " + message);
 }

 //ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ í˜¸ì¶œ
 public void disconnect() {
 System.out.println("close: " + url);
 }
}
```

í…ŒìŠ¤íŠ¸

```java
@Test
    public void lifeCycleTest() {
        ConfigurableApplicationContext ac = new AnnotationConfigApplicationContext(LifeCycleConfig.class);
        NetworkClient client = ac.getBean(NetworkClient.class);
        ac.close(); //ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ ì¢…ë£Œ, ConfigurableApplicationContext í•„ìš”
    }
    @Configuration
    static class LifeCycleConfig {
        @Bean
        public NetworkClient networkClient() {
            NetworkClient networkClient = new NetworkClient();
            networkClient.setUrl("http://hello-spring.dev");
            return networkClient;
        }
    }
```

ê²°ê³¼

```java
ìƒì„±ì í˜¸ì¶œ, url = null
connect: null
call: null message = ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€
```

â†’ url ì •ë³´ ì—†ì–´ì„œ null

â†’ ê°ì²´ë¥¼ ìƒì„±í•œ ë‹¤ìŒì— ì™¸ë¶€ì—ì„œ ìˆ˜ì •ì ì£¼ì…ì„ í†µí•´ì„œ setUrl() ì´ í˜¸ì¶œë˜ì–´ì•¼ urlì´ ì¡´ì¬

**SOLUTION**

- ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ë‹¤ ëë‚œ ë‹¤ìŒì—ì•¼ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¤€ë¹„ê°€ ì™„ë£Œ
    - ì´ˆê¸°í™” ì‘ì—…ì€ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ëª¨ë‘ ì™„ë£Œë˜ê³  ë‚œ ë‹¤ìŒì— í˜¸ì¶œ

<aside>
ğŸ’¡ **ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë²¤íŠ¸ ë¼ì´í”„ì‚¬ì´í´**
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± â†’ ìŠ¤í”„ë§ ë¹ˆ ìƒì„± â†’ ì˜ì¡´ê´€ê³„ ì£¼ì… â†’**ì´ˆê¸°í™” ì½œë°± ì‚¬ìš©** â†’ ì‚¬ìš© â†’ **ì†Œë©¸ì „ ì½œë°±** â†’ ìŠ¤í”„ë§ ì¢…ë£Œ

</aside>

- ì´ˆê¸°í™” ì½œë°±: ë¹ˆì´ ìƒì„±ë˜ê³ , ë¹ˆì˜ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì™„ë£Œëœ í›„ í˜¸ì¶œ
- ì†Œë©¸ì „ ì½œë°±: ë¹ˆì´ ì†Œë©¸ë˜ê¸° ì§ì „ì— í˜¸ì¶œ

---

### 1) ì¸í„°í˜ì´ìŠ¤ InitializingBean, DisposableBean

- InitializingBean : afterPropertiesSet()ë¡œ ì´ˆê¸°í™”ë¥¼ ì§€ì›
- DisposableBean : destroy()ë¡œ ì†Œë©¸ì„ ì§€ì›

```java
public class NetworkClient implements InitializingBean, DisposableBean {
    private String url;
    public NetworkClient() {
        System.out.println("ìƒì„±ì í˜¸ì¶œ, url = " + url);
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
    }
    public void setUrl(String url) {
        this.url = url;
    }
    //ì„œë¹„ìŠ¤ ì‹œì‘ì‹œ í˜¸ì¶œ
    public void connect() {
        System.out.println("connect: " + url);
    }
    public void call(String message) {
        System.out.println("call: " + url + " message = " + message);
    }
    //ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ í˜¸ì¶œ
    public void disconnect() {
        System.out.println("close: " + url);
    }

    //ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ëë‚˜ë©´
    @Override
    public void afterPropertiesSet() throws Exception {
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
    }
    //ì‚¬ìš© ëë‚˜ë©´
    @Override
    public void destroy() throws Exception {
        disconnect();
    }
}
```

**ë‹¨ì **

- í•´ë‹¹ ì½”ë“œê°€ ìŠ¤í”„ë§ ì „ìš© ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´
- ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œì˜ ì´ë¦„ì„ ë³€ê²½ X
- ë‚´ê°€ ì½”ë“œë¥¼ ê³ ì¹  ìˆ˜ ì—†ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì ìš© X

â€”> ê±°ì˜ ì‚¬ìš© X

---

### 2) ë¹ˆ ë“±ë¡ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œ

- ì„¤ì • ì •ë³´ì— @Bean(initMethod = "init", destroyMethod = "close") ì²˜ëŸ¼ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œë¥¼ ì§€ì •

```java
public class NetworkClient {
    private String url;
    public NetworkClient() {
        System.out.println("ìƒì„±ì í˜¸ì¶œ, url = " + url);
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
    }
    public void setUrl(String url) {
        this.url = url;
    }
    //ì„œë¹„ìŠ¤ ì‹œì‘ì‹œ í˜¸ì¶œ
    public void connect() {
        System.out.println("connect: " + url);
    }
    public void call(String message) {
        System.out.println("call: " + url + " message = " + message);
    }
    //ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ í˜¸ì¶œ
    public void disconnect() {
        System.out.println("close: " + url);
    }

    public void init() {
        System.out.println("NetworkClient.init");
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
    }
    public void close() {
        System.out.println("NetworkClient.close");
        disconnect();
    }
}
```

```java
@Configuration
    static class LifeCycleConfig {
        @Bean(initMethod = "init", destroyMethod = "close")
        public NetworkClient networkClient() {
            NetworkClient networkClient = new NetworkClient();
            networkClient.setUrl("http://hello-spring.dev");
            return networkClient;
        }
    }
```

**íŠ¹ì§•**

- ë©”ì„œë“œ ì´ë¦„ì„ ììœ ë¡­ê²Œ
- ìŠ¤í”„ë§ ë¹ˆì´ ìŠ¤í”„ë§ ì½”ë“œì— ì˜ì¡´X
- ì½”ë“œê°€ ì•„ë‹ˆë¼ ì„¤ì • ì •ë³´ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œë¥¼ ê³ ì¹  ìˆ˜ ì—†ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ë„ ì´ˆê¸°í™”, ì¢…ë£Œ ë©”ì„œë“œ ì ìš© ê°€ëŠ¥

**ì¢…ë£Œ ë©”ì„œë“œ ì¶”ë¡ **

- @Beanì˜ destroyMethod ê¸°ë³¸ê°’ : (inferred) â†’ ì¶”ë¡ 
    - ì´ ì¶”ë¡  ê¸°ëŠ¥ì€ close , shutdown ë¼ëŠ” ì´ë¦„ì˜ ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ í˜¸ì¶œ
        
        ( ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ëŒ€ë¶€ë¶„ close, shutdown ì´ë¼ëŠ” ì¢…ë£Œ ë©”ì„œë“œ ì‚¬ìš© )
        
        â†’ ì§ì ‘ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë©´ ì¢…ë£Œ ë©”ì„œë“œëŠ” ë”°ë¡œ ì ì–´ì£¼ì§€ ì•Šì•„ë„ ì˜ ë™ì‘
        
- ì¶”ë¡  ê¸°ëŠ¥ X â†’ destroyMethod="", ë¹ˆ ê³µë°± ì§€ì •

---

### â€¼ï¸(ê¶Œì¥) 3)ì• ë…¸í…Œì´ì…˜ @PostConstruct, @PreDestroy

- @PostConstruct , @PreDestroy ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš© â†’ ê°€ì¥ í¸ë¦¬

```java
public class NetworkClient {
    private String url;
    public NetworkClient() {
        System.out.println("ìƒì„±ì í˜¸ì¶œ, url = " + url);
    }
    public void setUrl(String url) {
        this.url = url;
    }
    //ì„œë¹„ìŠ¤ ì‹œì‘ì‹œ í˜¸ì¶œ
    public void connect() {
        System.out.println("connect: " + url);
    }
    public void call(String message) {
        System.out.println("call: " + url + " message = " + message);
    }
    //ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ í˜¸ì¶œ
    public void disConnect() {
        System.out.println("close + " + url);
    }
    @PostConstruct
    public void init() {
        System.out.println("NetworkClient.init");
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
    }
    @PreDestroy
    public void close() {
        System.out.println("NetworkClient.close");
        disConnect();
    }
}
```

**íŠ¹ì§•**

- ìŠ¤í”„ë§ì— ì¢…ì†ì ì¸ ê¸°ìˆ ì´ ì•„ë‹ˆë¼ ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œë„ ë™ì‘
- ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ê³¼ ì˜ ì–´ìš¸ë¦¼
- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ëŠ” ì ìš©X
    - @Beanì˜ ê¸°ëŠ¥ ( initMethod , destroyMethod ) ì‚¬ìš©
