# ì˜ì¡´ê´€ê³„ ìë™ ì£¼ì…

### ë‹¤ì–‘í•œ ì˜ì¡´ê´€ê³„ ì£¼ì… ë°©ë²•

**1 ) ìƒì„±ì ì£¼ì… â€”> ê¶Œì¥**

- ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ê°€ í–ˆë˜ ë°©ë²•
- ìƒì„±ì í˜¸ì¶œì‹œì ì— ë”± 1ë²ˆë§Œ í˜¸ì¶œ
    - í•œë²ˆ í˜¸ì¶œí•œ ë’¤ì— ë°”ê¾¸ëŠ” ê²ƒì„ ë§‰ì„ ìˆ˜ ìˆìŒ
- **ë¶ˆë³€, í•„ìˆ˜** ì˜ì¡´ê´€ê³„

<aside>
ğŸ’¡ **ìƒì„±ìê°€ ë”± 1ê°œë§Œ ìˆìœ¼ë©´ @Autowiredë¥¼ ìƒëµí•´ë„ ìë™ì£¼ì… ë¨.** ( ìŠ¤í”„ë§ ë¹ˆì—ë§Œ í•´ë‹¹ )

</aside>

```java
@Component
public class OrderServiceImpl implements OrderService {
	 private final MemberRepository memberRepository;
	 private final DiscountPolicy discountPolicy;

	 // @Autowired -> ìƒëµí•´ë„ ìë™ ì£¼ì…
	 public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
			 this.memberRepository = memberRepository;
			 this.discountPolicy = discountPolicy;
 }
}
```

**2) ìˆ˜ì •ì ì£¼ì… ( setter ì£¼ì… )**

- setter : í•„ë“œì˜ ê°’ì„ ë³€ê²½í•˜ëŠ” ìˆ˜ì •ì ë©”ì„œë“œ â†’ ì˜ì¡´ê´€ê³„ ì£¼ì…
- **ì„ íƒ, ë³€ê²½** ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì˜ì¡´ê´€ê³„

```java
@Component
public class OrderServiceImpl implements OrderService {
    private MemberRepository memberRepository;
    private DiscountPolicy discountPolicy;

    //ìˆ˜ì •ì ì£¼ì…: set ~ ê´€ë¡€
    @Autowired
    public void setDiscountPolicy(DiscountPolicy discountPolicy) {
        this.discountPolicy = discountPolicy;
    }
    @Autowired
    public void setMemberRepository(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }
}
```

**3) í•„ë“œ ì£¼ì…**

- í•„ë“œì— ë°”ë¡œ ì£¼ì…
- ì‚¬ìš©í•˜ì§€ ë§ì!!
    - í…ŒìŠ¤íŠ¸ ì½”ë“œ or ìŠ¤í”„ë§ ì„¤ì •ì„ ëª©ì ìœ¼ë¡œ í•˜ëŠ” @Configuration ê°™ì€ ê³³ì—ì„œë§Œ íŠ¹ë³„í•œ ìš©ë„ë¡œ ì‚¬ìš©

```java
@Component
public class OrderServiceImpl implements OrderService {
    @Autowired private MemberRepository memberRepository;
    @Autowired private DiscountPolicy discountPolicy;
}
```

**4) ì¼ë°˜ ë©”ì„œë“œ ì£¼ì…**

- ì¼ë°˜ ë©”ì„œë“œë¥¼ í†µí•´ì„œ ì£¼ì… ë°›ì„ ìˆ˜ ìˆìŒ.
- ì¼ë°˜ì ìœ¼ë¡œ ì˜ ì‚¬ìš© X

```java
@Component
public class OrderServiceImpl implements OrderService {
 private MemberRepository memberRepository;
 private DiscountPolicy discountPolicy;

 @Autowired
 public void init(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
 this.memberRepository = memberRepository;
 this.discountPolicy = discountPolicy;
 }
}
```

---

### ì˜µì…˜ ì²˜ë¦¬

- @Autowired ë§Œ ì‚¬ìš©í•˜ë©´ required ì˜µì…˜ì˜ ê¸°ë³¸ê°’ì´ true ë¡œ ë˜ì–´ ìˆì–´ì„œ ìë™ ì£¼ì… ëŒ€ìƒì´ ì—†ìœ¼ë©´ ì˜¤ë¥˜ê°€ ë°œìƒ
    - @Autowired(required=false) : ìë™ ì£¼ì…í•  ëŒ€ìƒì´ ì—†ìœ¼ë©´ ìˆ˜ì •ì ë©”ì„œë“œ ìì²´ê°€ í˜¸ì¶œX
    - org.springframework.lang.@Nullable : ìë™ ì£¼ì…í•  ëŒ€ìƒì´ ì—†ìœ¼ë©´ null
    - Optional<> : ìë™ ì£¼ì…í•  ëŒ€ìƒì´ ì—†ìœ¼ë©´ Optional.empty

```java
//í˜¸ì¶œ ì•ˆë¨
 @Autowired(required = false)
public void setNoBean1(Member member) {
    System.out.println("setNoBean1 = " + member);
}
//null í˜¸ì¶œ
@Autowired
public void setNoBean2(@Nullable Member member) {
    System.out.println("setNoBean2 = " + member);
}
//Optional.empty í˜¸ì¶œ
@Autowired(required = false)
public void setNoBean3(Optional<Member> member) {
    System.out.println("setNoBean3 = " + member);
}
```

---

### ì¡°íšŒ ë¹ˆì´ 2ê°œ ì´ìƒ

@Autowired ëŠ” íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ

â†’ ì„ íƒëœ ë¹ˆì´ 2ê°œ ì´ìƒì¼ ë•Œ ë¬¸ì œê°€ ë°œìƒ

**ë¬¸ì œ**
: DiscountPolicy ì˜ í•˜ìœ„ íƒ€ì…ì¸ FixDiscountPolicy , RateDiscountPolicy ë‘˜ë‹¤ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ì„ ì–¸ 

â†’ ì˜ì¡´ê´€ê³„ ìë™ ì£¼ì…ì„ ì‹¤í–‰ 

â†’ NoUniqueBeanDefinitionException ì˜¤ë¥˜

```java
@Component
public class FixDiscountPolicy implements DiscountPolicy {}
```

```java
@Component
public class RateDiscountPolicy implements DiscountPolicy {}
```

**SOL1) @Autowired í•„ë“œ ëª…**

- @Autowired ëŠ” íƒ€ì… ë§¤ì¹­ì„ ì‹œë„
    
    â†’ ì—¬ëŸ¬ ë¹ˆ ìˆìœ¼ë©´ â†’ í•„ë“œ ì´ë¦„, íŒŒë¼ë¯¸í„° ì´ë¦„ìœ¼ë¡œ ë§¤ì¹­ ( ì¶”ê°€ ë™ì‘ )
    

**í•„ë“œ ëª…ì„ ë¹ˆ ì´ë¦„ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ í•´ê²°**

```java
@Autowired
private DiscountPolicy discountPolicy
```

```java
@Autowired
private DiscountPolicy rateDiscountPolicy
```

**SOL2) @Qualifier**

- ì¶”ê°€ êµ¬ë¶„ìë¥¼ ë¶™ì—¬ì£¼ëŠ” ë°©ë²•
- ì£¼ì…ì‹œ ì¶”ê°€ì ì¸ ë°©ë²•ì„ ì œê³µ, ë¹ˆ ì´ë¦„ ë³€ê²½X

**ë™ì‘ ê³¼ì •**

1. @Qualifierë¼ë¦¬ ë§¤ì¹­
2. ë¹ˆ ì´ë¦„ ë§¤ì¹­ ( sol1ì²˜ëŸ¼ ì¶”ê°€ ë§¤ì¹­ )
3. NoSuchBeanDefinitionException ì˜ˆì™¸ ë°œìƒ

```java
@Component
@Qualifier("mainDiscountPolicy")
public class RateDiscountPolicy implements DiscountPolicy {}
```

```java
@Component
@Qualifier("fixDiscountPolicy")
public class FixDiscountPolicy implements DiscountPolicy {}
```

â†’ ìƒì„±ì ìë™ ì£¼ì… ì˜ˆì‹œ

```java
@Autowired
public OrderServiceImpl(MemberRepository memberRepository, @Qualifier("mainDiscountPolicy") DiscountPolicy discountPolicy) {
 this.memberRepository = memberRepository;
 this.discountPolicy = discountPolicy;
}
```

**SOL3) @Primary**

- ìš°ì„ ìˆœìœ„ë¥¼ ì •í•˜ëŠ” ë°©ë²•
- ì—¬ëŸ¬ ë¹ˆì´ ë§¤ì¹­ë˜ë©´ @Primary ê°€ ìš°ì„ ê¶Œì„ ê°€ì§.

```java
@Component
@Primary
public class RateDiscountPolicy implements DiscountPolicy {}
```

```java
@Component
public class FixDiscountPolicy implements DiscountPolicy {}
```

â†’ ì‚¬ìš©ì½”ë“œ

```java
@Component
public class FixDiscountPolicy implements DiscountPolicy {}
```

@Primary, @Qualifier

- @Qualifier ì˜ ë‹¨ì  : ëª¨ë“  ì½”ë“œì— @Qualifier ë¶™ì—¬ì£¼ì–´ì•¼ í•œë‹¤ëŠ” ì 
    - @Primaryê°€ í¸ë¦¬í•˜ê²Œ ì¡°íšŒ â†’ ë©”ì¸ ë°ì´í„° ë² ì´ìŠ¤ì˜ ì»¤ë„¥ì…˜ì„ íšë“
- @Qualifierì˜ ì¥ì  :ìƒì„¸í•˜ê²Œ ë™ì‘
    - @Qualifier ì§€ì • â†’ ì„œë¸Œ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ ë¹ˆì„ íšë“
- @Qualifier ìš°ì„ ê¶Œì´ ë†’ìŒ

---

### ì• ë…¸í…Œì´ì…˜ ì§ì ‘ ë§Œë“¤ê¸°

- @Qualifier("mainDiscountPolicy") ì´ë ‡ê²Œ ë¬¸ìë¥¼ ì ìœ¼ë©´ ì»´íŒŒì¼ ì‹œ íƒ€ì… ì²´í¬ X â†’ ì• ë…¸í…Œì´ì…˜ ìƒì„±ìœ¼ë¡œ í•´ê²°
    - @Qualifier("mainDiscountPolicy") ëŒ€ì‹  @Qualifier("nainDiscountPolicy") ìœ¼ë¡œ ì…ë ¥í•˜ì˜€ì„ ê²½ìš° ë¬¸ìì—´ì´ê¸° ë•Œë¬¸ì— íƒ€ì…ì²´í¬ê°€ ë¶ˆê°€ëŠ¥
    - @MainDiscountPolicy ëŒ€ì‹   @NainDiscountPolicyë¡œ ì…ë ¥í•˜ì˜€ì„ ê²½ìš° ì‚¬ì „ì— ë“±ë¡ë˜ì–´ ìˆëŠ” ì—ë…¸í…Œì´ì…˜ì´ ì—†ê¸° ë•Œë¬¸ì— íƒ€ì…ì²´í¬ê°€ ê°€ëŠ¥
        
        â†’ ì»´íŒŒì¼ ì—ëŸ¬ X
        

ìƒì„±

```java
import org.springframework.beans.factory.annotation.Qualifier;
import java.lang.annotation.*;

@Target({ElementType.FIELD, ElementType.METHOD, ElementType.PARAMETER,ElementType.TYPE, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Qualifier("mainDiscountPolicy")
public @interface MainDiscountPolicy {
}
```

```java
@Component
@MainDiscountPolicy
public class RateDiscountPolicy implements DiscountPolicy {}
```

ì ìš©

```java
@Autowired
public OrderServiceImpl(MemberRepository memberRepository,@MainDiscountPolicy DiscountPolicy discountPolicy) {
 this.memberRepository = memberRepository;
 this.discountPolicy = discountPolicy;
}
```

---

### ì¡°íšŒí•œ ë¹ˆì´ ëª¨ë‘ í•„ìš”í•  ë•Œ, List, Map

- í•´ë‹¹ íƒ€ì…ì˜ ìŠ¤í”„ë§ ë¹ˆì´ ë‹¤ í•„ìš”í•œ ê²½ìš°
    - Map<String, DiscountPolicy> : keyâ†’ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„, valueâ†’DiscountPolicy íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•œ ëª¨ë“  ìŠ¤í”„ë§ ë¹ˆ
    - List<DiscountPolicy> : DiscountPolicy íƒ€ì…ìœ¼ë¡œ ì¡°íšŒí•œ ëª¨ë“  ìŠ¤í”„ë§ ë¹ˆ

```java
public class AllBeanTest {
    @Test
    void findAllBean() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(AutoAppConfig.class, DiscountService.class);
        DiscountService discountService = ac.getBean(DiscountService.class);
        Member member = new Member(1L, "userA", Grade.VIP);
        int discountPrice = discountService.discount(member, 10000, "fixDiscountPolicy");
        
				assertThat(discountService).isInstanceOf(DiscountService.class);
        assertThat(discountPrice).isEqualTo(1000);
    }
    static class DiscountService {
        private final Map<String, DiscountPolicy> policyMap;
        private final List<DiscountPolicy> policies;

        public DiscountService(Map<String, DiscountPolicy> policyMap, List<DiscountPolicy> policies) {
            this.policyMap = policyMap;
            this.policies = policies;
            System.out.println("policyMap = " + policyMap);
            System.out.println("policies = " + policies);
        }

        public int discount(Member member, int price, String discountCode) {
            DiscountPolicy discountPolicy = policyMap.get(discountCode);
            System.out.println("discountCode = " + discountCode);
            System.out.println("discountPolicy = " + discountPolicy);
            
						return discountPolicy.discount(member, price);
        }
    }
}
```

---

### ìë™, ìˆ˜ë™ì˜ ì˜¬ë°”ë¥¸ ì‹¤ë¬´ ìš´ì˜ ê¸°ì¤€

- í¸ë¦¬í•œ ìë™ ê¸°ëŠ¥ì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§
    - ì—…ë¬´ ë¡œì§ ë¹ˆ â†’ ìœ ì‚¬í•œ íŒ¨í„´ â†’ ìë™ ê¸°ëŠ¥
    - ê¸°ìˆ  ì§€ì› ë¹ˆ â†’ íŒŒì•… ì–´ë ¤ì›€ â†’ ìˆ˜ë™ ê¸°ëŠ¥
    - ë‹¤í˜•ì„± ì ê·¹ í™œìš© â†’ ìˆ˜ë™ ë¹ˆ ë“±ë¡ or ìë™ì¼ ê²½ìš° íŠ¹ì • íŒ¨í‚¤ì§€ì— ë¬¶ê¸°
